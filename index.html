<script>
    // Logic for Purity Calculator (Instant Update)
    function calculateGold() {
        // You can update this spot price manually or link it to an API
        const spotPrice = 2740.50; 
        const ozToGram = 31.1035;
        
        let qty = document.getElementById('qty').value;
        let unit = document.getElementById('unit').value;
        let purity = document.getElementById('karat').value;
        
        let weightInGrams = qty;
        if (unit === "kg") weightInGrams = qty * 1000;
        if (unit === "oz") weightInGrams = qty * ozToGram;

        let finalValue = (weightInGrams * (spotPrice / ozToGram)) * purity;
        document.getElementById('liveResult').innerText = "$" + finalValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

    // NEW: Real Historical Lookup for ANY date
    async function lookupHistorical() {
        let dateInput = document.getElementById('histDate').value; // Get YYYY-MM-DD
        let displayDate = dateInput.replace(/-/g, ""); // Convert to YYYYMMDD for the API
        
        document.getElementById('histLabel').innerText = "Searching price for " + dateInput + "...";
        document.getElementById('histResult').innerText = "Loading...";

        try {
            // Using a public free gold price endpoint
            const response = await fetch(`https://www.goldapi.io/api/XAU/USD/${displayDate}`, {
                method: 'GET',
                headers: {
                    "x-access-token": "goldapi-1b3vsm2636p6y-io", // Free Demo Key
                    "Content-Type": "application/json"
                }
            });

            const data = await response.json();

            if (data.price) {
                document.getElementById('histLabel').innerText = "Price on " + dateInput + ":";
                document.getElementById('histResult').innerText = "$" + data.price.toLocaleString(undefined, {minimumFractionDigits: 2});
            } else {
                document.getElementById('histResult').innerText = "Not Found";
                alert("No market data for this date (might be a weekend or holiday).");
            }
        } catch (error) {
            console.error("Error fetching gold price:", error);
            document.getElementById('histResult').innerText = "Error";
            alert("Could not connect to the database. Please try again in a moment.");
        }
    }

    // Initialize the calculator on page load
    calculateGold();
</script>
